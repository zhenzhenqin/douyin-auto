<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æŠ–éŸ³ç«èŠ±è‡ªåŠ¨ç»­ - æ§åˆ¶å°</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { margin-top: 0; color: #333; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="text"], input[type="time"] { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        button { background: #fe2c55; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px; transition: 0.2s; }
        button:hover { opacity: 0.9; }
        button.secondary { background: #333; }
        button.green { background: #07c160; width: 100%; margin-top: 10px;}
        #log { background: #222; color: #0f0; padding: 15px; border-radius: 5px; height: 150px; overflow-y: scroll; font-family: monospace; font-size: 12px; margin-top: 20px;}
        .tips { font-size: 12px; color: #888; margin-top: 5px; }
    </style>
</head>
<body>
<div class="card">
    <h2>âš™ï¸ å…¨å±€é…ç½®</h2>

    <div class="form-group">
        <label>å¥½å‹æ˜µç§°ï¼š</label>
        <input type="text" id="friendName" placeholder="ä¾‹å¦‚ï¼šå§å”§å§å”§">
    </div>

    <div class="form-group">
        <label>æ¯å¤©å®šæ—¶è¿è¡Œæ—¶é—´ï¼š</label>
        <input type="time" id="scheduleTime">
        <div class="tips">è®¾ç½®åéœ€ç‚¹å‡»ä¸‹æ–¹â€œå¼€å¯/æ›´æ–°è‡ªåŠ¨ç»­ç«èŠ±â€æ‰ä¼šç”Ÿæ•ˆ</div>
    </div>

    <button onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
</div>

<div class="card">
    <h2>ğŸš€ æ“ä½œä¸­å¿ƒ</h2>
    <div style="margin-bottom: 15px;">
        <p>1. é¦–æ¬¡ä½¿ç”¨å¿…é¡»æ‰«ç ç™»å½•ï¼š</p>
        <button class="secondary" onclick="runLogin()">æ‰«ç ç™»å½•</button>
    </div>
    <div style="margin-bottom: 15px;">
        <p>2. æµ‹è¯•è„šæœ¬æ˜¯å¦æ­£å¸¸ï¼š</p>
        <button onclick="runNow()">ç«‹å³è¿è¡Œä¸€æ¬¡</button>
    </div>
    <div style="border-top: 1px solid #eee; padding-top: 15px;">
        <p>3. ç»ˆæéƒ¨ç½² (åå°é™é»˜è¿è¡Œ)ï¼š</p>
        <button class="green" onclick="setSchedule()">â° å¼€å¯ / æ›´æ–° æ¯æ—¥è‡ªåŠ¨ä»»åŠ¡</button>
    </div>
</div>

<div id="log">ç­‰å¾…æ“ä½œ...</div>

<script>
    const logDiv = document.getElementById('log');
    function log(msg) {
        logDiv.innerText = msg + '\n' + logDiv.innerText; // æ–°æ—¥å¿—åœ¨æœ€ä¸Šé¢
    }

    // åŠ è½½é…ç½®
    fetch('/api/config').then(r => r.json()).then(data => {
        document.getElementById('friendName').value = data.friendName || '';
        // å¦‚æœæ²¡æœ‰ä¿å­˜è¿‡æ—¶é—´ï¼Œé»˜è®¤æ˜¾ç¤º 08:00
        document.getElementById('scheduleTime').value = data.scheduleTime || '08:00';
    });

    async function saveConfig() {
        const name = document.getElementById('friendName').value;
        const time = document.getElementById('scheduleTime').value;

        if(!name || !time) return alert('è¯·å¡«å†™å®Œæ•´çš„åå­—å’Œæ—¶é—´ï¼');

        await fetch('/api/config', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ friendName: name, scheduleTime: time })
        });
        log(`é…ç½®å·²ä¿å­˜: ${name} / ${time}`);
        alert('é…ç½®ä¿å­˜æˆåŠŸï¼');
    }

    async function runLogin() {
        log('æ­£åœ¨å¯åŠ¨ç™»å½•çª—å£...');
        const res = await fetch('/api/login', { method: 'POST' });
        log(await res.text());
    }

    async function runNow() {
        log('æ­£åœ¨åå°è¿è¡Œè„šæœ¬ï¼Œè¯·ç¨å€™...');
        const res = await fetch('/api/run', { method: 'POST' });
        const text = await res.text();
        if(res.ok) log('æ‰§è¡Œå®Œæˆ');
        else log('æ‰§è¡Œå‡ºé”™:\n' + text);
    }

    async function setSchedule() {
        // å…ˆä¿å­˜é…ç½®ï¼Œç¡®ä¿æ—¶é—´æ˜¯æœ€æ–°çš„
        await saveConfig();

        log('æ­£åœ¨æ›´æ–°ç³»ç»Ÿå®šæ—¶ä»»åŠ¡...');
        const res = await fetch('/api/schedule', { method: 'POST' });
        const data = await res.json();

        if(data.success) {
            alert(data.msg);
            log(data.msg);
        } else {
            alert('å¤±è´¥: ' + data.error);
            log(data.details);
        }
    }
</script>
</body>
</html>